<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yami.trading.dao.user.MoneyLogMapper">


    <select id="pageMoneyLog" resultType="com.yami.trading.bean.user.dto.MoneyLogDto">
        SELECT
        m.*,
        u.user_name,
        u.user_code,
        u.role_name,
        ur.user_name AS 'recomUserName',
        ur.user_code AS 'recomUserCode'
        FROM
        t_money_log m
        LEFT JOIN tz_user u ON m.user_id = u.user_id
        LEFT JOIN tz_user ur ON u.user_recom = ur.user_id
        WHERE
        1 =1


        <if test="rolename!=null and rolename!=''">
            and u.role_name=#{rolename}
        </if>
        <if test="userCode!='' and userCode!=null">
            and u.user_code=#{userCode}
        </if>

        <if test="userName!=null and userName!=''">
            and u.user_name=#{userName} or u.user_code=#{userName}
        </if>

        <if test="log!=null and log!=''">
            and m.log  like  CONCAT('%', #{log}, '%')
        </if>
        <if test="category!=null and category!=''">
            and m.category=#{category}
        </if>

        <if test="startTime!=null and endTime!=null">
            and m.create_time BETWEEN #{startTime} and #{endTime}
        </if>
        order by m.create_time desc
    </select>


    <select id="sumBSalance" resultType="java.util.HashMap">
        SELECT
            round(
                    sum(
                            IF
                                ( create_time >= date( now()), amount, 0 )),
                    2
                ) AS dateamount,
            round( ifnull( sum( amount ), 0 ), 2 ) AS sumamount
        FROM
            t_money_log
        WHERE
            category =#{category}
          AND content_type =#{contentType}
          AND user_id =#{userId}
    </select>
</mapper>
