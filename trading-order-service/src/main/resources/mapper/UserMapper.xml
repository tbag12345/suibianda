<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yami.trading.dao.user.UserMapper">
    <resultMap id="BaseResultMap" type="com.yami.trading.bean.model.User">
        <!--
          WARNING - @mbg.generated
        -->
        <id column="user_id" jdbcType="VARCHAR" property="userId"/>
        <result column="nick_name" jdbcType="VARCHAR" property="nickName"/>
        <result column="real_name" jdbcType="VARCHAR" property="realName"/>
        <result column="user_mail" jdbcType="VARCHAR" property="userMail"/>
        <result column="login_password" jdbcType="VARCHAR" property="loginPassword"/>
        <result column="pay_password" jdbcType="VARCHAR" property="payPassword"/>
        <result column="user_mobile" jdbcType="VARCHAR" property="userMobile"/>
        <result column="modify_time" jdbcType="TIMESTAMP" property="modifyTime"/>
        <result column="user_regtime" jdbcType="TIMESTAMP" property="userRegtime"/>
        <result column="user_regip" jdbcType="VARCHAR" property="userRegip"/>
        <result column="user_lasttime" jdbcType="TIMESTAMP" property="userLasttime"/>
        <result column="user_lastip" jdbcType="VARCHAR" property="userLastip"/>
        <result column="user_memo" jdbcType="VARCHAR" property="userMemo"/>
        <result column="sex" jdbcType="CHAR" property="sex"/>
        <result column="birth_date" jdbcType="CHAR" property="birthDate"/>
        <result column="pic" jdbcType="VARCHAR" property="pic"/>
        <result column="status" jdbcType="INTEGER" property="status"/>
    </resultMap>

    <select id="getUserByUserMail" resultType="com.yami.trading.bean.model.User">
        select *
        from tz_user u
        where u.user_mail = #{userMail}
    </select>
    <select id="selectOneByUserName" resultType="com.yami.trading.bean.model.User">
        select *
        from `tz_user`
        where binary nick_name = #{userName} limit 1
    </select>


    <select id="listUser" resultType="com.yami.trading.bean.user.dto.UserDto">

        SELECT * FROM tz_user u LEFT JOIN tz_wallet w ON u.user_id=w.user_id

        where 1=1 and u.role_name in
        <foreach collection="roleNames" separator="," index="index" open="(" close=")" item="r">
            #{r}
        </foreach>

        <if test="userCode!=null and userCode!=''">
            and u.user_code=#{userCode}
        </if>

        <if test="userName!=null and userName!=''">
            and u.user_name=#{userName}
        </if>

        <if test="checkedList!=null">
            and u.user_id in
            <foreach collection="checkedList" separator="," index="index" open="(" close=")" item="r">
                #{r}
            </foreach>

        </if>
        order by u.create_time desc
    </select>


    <select id="getAgentAllStatistics" resultType="com.yami.trading.bean.user.dto.AgentUserDto">
        SELECT party.role_name, party.user_name, party.user_code, party.user_id
        FROM tz_user party
--                  LEFT JOIN tz_user_recom ur ON party.user_id = ur.user_id
        WHERE 1 = 1
          AND party.role_name IN ("AGENT", "AGENTLOW")

        <if test="userName!=null and userName!=''">
            and party.user_name=#{userName} or party.user_code=#{userName}
        </if>
          <if test="children!=null">
               and party.user_id in
              <foreach collection="children" index="index" item="item" open="(" separator="," close=")">
                  #{item}
              </foreach>
          </if>


        ORDER BY party.user_code ASC
    </select>

    <select id="listUserAndRecom" resultType="com.yami.trading.bean.user.dto.UserDataDto">

        SELECT u.*,r.user_name AS 'recomUserName' FROM tz_user u LEFT JOIN
        tz_user r
        ON u.user_recom=r.user_id

        where 1=1 and u.role_name in
        <foreach collection="roleNames" separator="," index="index" open="(" close=")" item="r">
            #{r}
        </foreach>

        <if test="checkedList!=null">
            and u.user_id in
            <foreach collection="checkedList" separator="," index="index" open="(" close=")" item="r">
                    #{r}
            </foreach>

        </if>
        <if test="userCode!=null and userCode!=''">
            and u.user_code=#{userCode}
        </if>

        <if test="userName!=null and userName!=''">
            and u.user_name=#{userName}
        </if>
        <if test="lastIp!=null and lastIp!=''">
            and u.user_lastip=#{lastIp}
        </if>
        order by u.create_time desc
    </select>
</mapper>
